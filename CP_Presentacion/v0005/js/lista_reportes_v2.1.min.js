function iniciarDataTableReportes(){tablaReportes=objTablaReportes.DataTable({dom:"Bfrtip",buttons:[{extend:"excelHtml5",text:"Exportar a EXCEL",exportOptions:{columns:[0,1,2,3,4,5,6,7]},title:function(){return nombreReportePerfil},sheetName:"Reportes"}],language:{url:"bower_components/datatables-buttons/json/spanish.json"},fnDrawCallback:function(){var n=objTablaReportes.DataTable();n.data().length===0?n.buttons(".dt-button").disable():n.buttons(".dt-button").enable();var t=this.api(),r=t.rows({page:"current"}).nodes(),i=null;t.column(1,{page:"current"}).data().each(function(n,t){i!==n&&($(r).eq(t).before('<tr class="group"><td colspan="10" style="text-align: center;" >'+n+"<\/td><\/tr>"),i=n)})},initComplete:function(){$(".dataTables_scrollBody thead tr").css({visibility:"collapse"})},aaSorting:[[1,"asc"],[3,"asc"]],bDestroy:!0,bDeferRender:!0,paging:!1,scrollY:$(document).height()-270+"px",scrollCollapse:!0,scroller:!0,bSort:!0,autoWidth:!1,responsive:!0,aoColumns:[{sWidth:"70px",sClass:"textoCentrado"},null,null,null,null,{visible:!1},null,null,null,{sClass:"center",bSortable:!1},{bSortable:!1,visible:validaControl("E")}]});$("#tbl_reportes tbody").on("click","tr.group",function(){var n=tablaReportes.order()[0];n[0]===1&&n[1]==="asc"?tablaReportes.order([1,"desc"],[3,"asc"]).draw():tablaReportes.order([1,"asc"],[3,"asc"]).draw()});CargarReportesPorUsuario()}function agregarFilasDT_Reportes(n){var i,t,r,u;for(objTablaReportes.dataTable().fnClearTable(),i=[],t=0;t<n.length;t++)i.push([n[t].cod_reporte,n[t].sistema,n[t].nombre,n[t].cod_alterno,n[t].propietario,n[t].ubicacion,n[t].directorio,n[t].subdirectorio,spanEstado(n[t].estado),fnEjecutar(n[t].estado,n[t].cod_alterno,n[t].url),'<button type="button" value="Actualizar" title="Actualizar" style="margin: 2px;"class="btn btn-xs  btn-primary btn-edit btn_datatable" data-target="#modal_reportes" data-toggle="modal"><i class="glyphicon glyphicon-pencil" aria-hidden="true"><\/i><\/button>&nbsp;<button type="button" value="Eliminar" title="Eliminar" style="margin: 2px;"class="btn btn-xs btn-danger  btn-delete btn_datatable"><i class="fa fa-minus-square-o" aria-hidden="true"><\/i><\/button>']);if(objTablaReportes.dataTable().fnAddData(i,!1),!$("#infoTitulo").length){u='<span class="form-group-todos" ><input type="checkbox" name="chkTodos" id="chkTodos" autocomplete="off" /><div class="[ btn-group ]" > <label for="chkTodos" class="[ btn btn-success ]" ><span class="[ glyphicon glyphicon-ok ]"><\/span><span > <\/span > <\/label > <label for="chkTodos" class="[ btn btn-default active ]">Mostrar TODOS los Reportes<\/label > <\/div > <\/span >&nbsp;&nbsp;&nbsp;';$(document).on("change","#chkTodos",function(){CargarReportesPorUsuario()});r=validaControl("A")?"<button runat='server' id='btn_ListaReportes_Agregar' type='button' class='Reportes dt-button buttons-html5' data-target='#modal_reportes' data-toggle='modal'><i class='glyphicon glyphicon-plus'><\/i><span>&nbsp;Agregar Reporte<\/span><\/button>":"";$("<span id='infoTitulo' class='dataTables_info' role='status' aria-live='polite'>Lista de Reportes&nbsp;&nbsp;&nbsp;"+r+"&nbsp;&nbsp;&nbsp;"+u+"<\/span>").prependTo("div.dt-buttons")}$("#tbl_reportes").on("draw.dt",function(){$(".dataTables_scrollBody thead tr").css({visibility:"collapse"})});tablaReportes.draw()}function spanEstado(n){return n==="Activo"?'<span class="label label-success" style="font-size:9px; padding-top: 1px; padding-bottom: 1px;">'+n+"<\/span>":n==="Inactivo"?'<span class="label label-danger"  style="font-size:9px; padding-top: 1px; padding-bottom: 1px;">'+n+"<\/span>":n==="Bloqueado"?'<span class="label label-warning"  style="font-size:9px; padding-top: 1px; padding-bottom: 1px;">'+n+"<\/span>":'<span class="label label-primary"  style="font-size:9px; padding-top: 1px; padding-bottom: 1px;">'+n+"<\/span>"}function validaControl(n){return validacion=!1,n==="A"?$("#FnAgregar").length&&(validacion=!0):n==="E"&&$("#FnEditar").length&&(validacion=!0),validacion}function fnEjecutar(n,t,i){return n==="Activo"?'<button type="button" value="'+i+'" title="Generar '+t+'" style="margin: 2px;" class="btn btn-xs  btn-warning btn-generar btn_datatable"><i class="glyphicon glyphicon-ok" aria-hidden="true"><\/i><\/button>':""}function CargarReportesPorUsuario(){dialogoProgreso.show('Cargando reportes <span class="glyphicon glyphicon-hourglass"><\/span>');animacion=dialogoProgreso.animate();var n={},t;t=$("#chkTodos").length?$("#chkTodos").is(":checked")?"T":"U":"U";n.login=login;n.tipo=t;AjaxCargarReportesUsuario(n)}function AjaxCargarReportesUsuario(n){n=JSON.stringify(n);$.ajax({type:"POST",url:paginaUrl+"/ReportesPorUsuario",data:n,contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta="Error: "+n.status+"<br>"+n.responseJSON.Message;"\n"+i;mensajeError(MensajeAlerta,paginaUrl);setTimeout(function(){window.location="./Login.aspx"},3e3)},success:function(n){n.d.length>0?agregarFilasDT_Reportes(n.d):(MsjPersonalizado="No existen reportes en la base de datos!",tipoMsj="info",Alerta("mensajesAlerta",MsjPersonalizado,tipoMsj,2e3))}}).done(function(){animacion!==undefined&&setTimeout(function(){dialogoProgreso.hide();dialogoProgreso.stopAnimate(animacion)},500)})}function cerrarModal(){$("#modal_reportes").modal("hide")}function llenarDataModal(n){var t="",i,r,u;n==="Editar"?(t="Actualizar Reporte ("+dataReportes[3]+")",r=dataReportes[5].substring(dataReportes[5].lastIndexOf("/")+1,dataReportes[5].length),$("#modalTitulo").text(t),$("#idReporte").val(dataReportes[0]),$("#codigoReporte").val(dataReportes[3]),$("#nombreReporte").val(dataReportes[2]),$("#archivoRpt").val(r),$("#ddlSistema").val($("#ddlSistema option:contains('"+dataReportes[1]+"')").val()),$("#ddlDirectorio").val($("#ddlDirectorio option:contains('"+dataReportes[6]+"')").val()),$("#ddlSubdirectorio").val($("#ddlSubdirectorio option:contains('"+dataReportes[7]+"')").val()),$("#ddlPropietario").val($("#ddlPropietario option:contains('"+dataReportes[4]+"')").val()),$("#ubicacionReporte").val(dataReportes[5]),i=$.parseHTML(dataReportes[8])[0].innerHTML==="Bloqueado"?"Activo":$.parseHTML(dataReportes[8])[0].innerHTML,$("#ddlEstado").val($("#ddlEstado option:contains('"+i+"')").val())):(t="Registro de Reportes",u="",$("#modalTitulo").text(t),i="Activo",$("#ddlEstado").val($("#ddlEstado option:contains('"+i+"')").val()))}function limpiarDataModal(){$("#modalTitulo").text("");$("#idReporte").val("");$("#codigoReporte").val("");$("#nombreReporte").val("");$("#archivoRpt").val("");$("#ddlSistema").val("1");$("#ddlDirectorio").val("1");$("#ddlSubdirectorio").val("1");$("#ddlPropietario").val("1");$("#ubicacionReporte").val("");$("#ddlEstado").val("1")}function procesarAccion(){var u=verificarInputVacios(),i,n,t,r;u===!1&&(i=$("#idReporte").val(),i===""?(n=$("#codigoReporte").val(),t=0,r=tablaReportes.rows().column(3).data().toArray(),t=jQuery.inArray(n,r),t===-1?RegistrarReporte():tablaReportes.data().any()&&(Alerta("mensajesAlerta","El C贸digo de Reporte ( "+n+" ) ya Existe!","danger",2e3),$("#codigoReporte").focus())):ActualizarReporte(),cerrarModal())}function verificarInputVacios(){var n=$("#codigoReporte").val(),t=$("#nombreReporte").val(),i=$("#archivoRpt").val();if(n==="")$("#codigoReporte").focus();else if(t==="")$("#nombreReporte").focus();else if(i==="")$("#archivoRpt").focus();else return!1}function RegistrarReporte(){var n={};n=JSON.stringify(ObtenerValores("C","0"));$.ajax({type:"POST",url:paginaUrl+"/MantenimientoReportes",data:n,contentType:"application/json; charset=utf-8",dataType:"json",error:function(n,t,i){MensajeAlerta=n.status+"\n"+n.responseText;"\n"+i;mensajeError(MensajeAlerta,paginaUrl)},success:function(){CargarReportesPorUsuario();MensajeAlerta="El reporte se registr贸 correctamente!";Alerta("mensajesAlerta",MensajeAlerta,"success",2e3)}})}function ActualizarReporte(){var n={};n=JSON.stringify(ObtenerValores("U","0","0"));$.ajax({type:"POST",url:paginaUrl+"/MantenimientoReportes",data:n,contentType:"application/json; charset=utf-8",dataType:"json",error:function(n,t,i){MensajeAlerta=n.status+"\n"+n.responseText;"\n"+i;mensajeError(MensajeAlerta,paginaUrl)},success:function(){CargarReportesPorUsuario();MensajeAlerta="El reporte se actualiz贸 correctamente!";Alerta("mensajesAlerta",MensajeAlerta,"success",2e3)}})}function InactivarReporte(n){var i=n.find("td:eq(0)").text(),r=n.find("td:eq(3)").text(),t={};t=JSON.stringify(ObtenerValores("D",i,r));$.ajax({type:"POST",url:paginaUrl+"/MantenimientoReportes",data:t,contentType:"application/json; charset=utf-8",dataType:"json",error:function(n,t,i){MensajeAlerta=n.status+"\n"+n.responseText;"\n"+i;mensajeError(MensajeAlerta,paginaUrl)},success:function(){CargarReportesPorUsuario();MensajeAlerta="El reporte se inactiv贸 correctamente!";Alerta("mensajesAlerta",MensajeAlerta,"success",2e3)}})}function ObtenerValores(n,t,i){var r={},u;return n==="D"?(u=t,r.accion=n,r.id=u,r.codigo=i,r.nombre="",r.archivoRpt="",r.cod_sistema="0",r.cod_directorio="0",r.cod_subdirectorio="0",r.ubicacion="0",r.cod_estado="",r.cod_usuario=cod_usuario,r.cod_propietario="1"):(u=$("#idReporte").val(),u===""&&(u="0"),r.accion=n,r.id=u,r.codigo=$("#codigoReporte").val(),r.nombre=$("#nombreReporte").val(),r.archivoRpt=$("#archivoRpt").val(),r.cod_sistema=$("#ddlSistema option:selected").val(),r.cod_directorio=$("#ddlDirectorio option:selected").val(),r.cod_subdirectorio=$("#ddlSubdirectorio option:selected").val(),r.ubicacion=$("#ubicacionReporte").val(),r.cod_estado=$("#ddlEstado option:selected").val(),r.cod_usuario=cod_usuario,r.cod_propietario=$("#ddlPropietario option:selected").val()),r}function CargarSubdirectorios(){var n={};n.cod_directorio=$("#ddlDirectorio option:selected").val();n=JSON.stringify(n);$.ajax({type:"POST",url:paginaUrl+"/CargarSubdirectorios",data:n,contentType:"application/json; charset=utf-8",dataType:"json",error:function(n,t,i){MensajeAlerta=n.status+"\n"+n.responseText;"\n"+i;mensajeError(MensajeAlerta,paginaUrl)},success:IniciarCargaSubdirectorios})}function IniciarCargaSubdirectorios(n){n.d.length>0?($("#ddlSubdirectorio").empty(),$.each(n.d,function(){$("#ddlSubdirectorio").append($("<option><\/option>").val(this.cod_subdirectorio).html(this.nombre))})):$("#ddlSubdirectorio").empty().append('<option selected="selected" value="0">NO EXISTEN SUBDIRECTORIOS<\/option>');ActualizarUbicacion()}function ActualizarUbicacion(){var n="";$("#ddlSubdirectorio option:selected").val()!=="0"&&(n="/"+$("#ddlSubdirectorio option:selected").text());$("#ubicacionReporte").val("/"+$("#ddlDirectorio option:selected").text()+n+"/"+$("#archivoRpt").val()+"")}var paginaUrl="ListaReportes.aspx",tablaReportes,dataReportes,objTablaReportes=$("#tbl_reportes"),inicio,MensajeAlerta,tipoMsj,nombreReportePerfil="Lista de Reportes - Report Manager",animacion;$(document).ready(function(){iniciarDataTableReportes();CargarSubdirectorios()});$("#btnModalCancelar").click(function(n){n.preventDefault();cerrarModal()});$(document).on("hidden.bs.modal","#modal_reportes",function(){limpiarDataModal()});$(document).on("shown.bs.modal","#modal_reportes",function(){$("#codigoReporte").focus()});$(document).on("click",".btn-edit",function(n){var t,i;n.preventDefault();t=$(this).parent().parent()[0];dataReportes=objTablaReportes.fnGetData(t);i="Editar";llenarDataModal(i)});$(document).on("click",".btn-generar",function(n){n.preventDefault();var t=$(this).val();window.open(t,"_blank")});$(document).on("click",".btn-delete",function(n){n.preventDefault();var t=$(this).closest("tr"),i=t.find("td:eq(7)").text();i!=="Inactivo"?InactivarReporte(t):(MensajeAlerta="El reporte ya est谩 inactivo!",Alerta("mensajesAlerta",MensajeAlerta,"warning",2e3))});$(document).on("click","#btn_ListaReportes_Agregar",function(n){n.preventDefault();llenarDataModal("Agregar")});$("#modal_reportes").on("change paste keyup","#archivoRpt ",function(){ActualizarUbicacion()});$("#modal_reportes").on("change","#ddlDirectorio",function(){CargarSubdirectorios()});$("#modal_reportes").on("change","#ddlSubdirectorio",function(){ActualizarUbicacion()});$(document).on("click","#btnModalAccion",function(){procesarAccion()});$("#modal_reportes").on("keypress",function(n){n.which===13&&$("#btnModalAccion").click()});