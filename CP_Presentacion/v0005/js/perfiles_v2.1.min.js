function iniciarDataTablePerfiles(){tablaPerfiles=objTablaPerfiles.DataTable({dom:"Bfrtip",buttons:[{extend:"excelHtml5",text:"Exportar a EXCEL",exportOptions:{columns:[0,1,2,3]},title:function(){return nombreReportePerfil},sheetName:"Perfiles"}],language:{url:"bower_components/datatables-buttons/json/spanish.json",buttons:{pageLength:{_:"MOSTRAR %d REGISTROS","-1":"TODOS"}}},fnDrawCallback:function(){var n=objTablaPerfiles.DataTable();n.data().length===0?n.buttons(".dt-button").disable():n.buttons(".dt-button").enable()},aaSorting:[[0,"desc"]],bDestroy:!0,bDeferRender:!0,paging:!1,scrollY:"147px",scrollCollapse:!0,scroller:!0,bSort:!0,autoWidth:!0,responsive:!1,aoColumns:[{sWidth:"70px",sClass:"textoCentrado"},null,null,null,{bSortable:!1}]})}function agregarFilasDT_Perfiles(n){var t,i;for(objTablaPerfiles.dataTable().fnClearTable(),t=0;t<n.length;t++)i=[],i[0]=n[t].id,i[1]=n[t].nombre,i[2]=n[t].descripcion,i[3]=spanEstado(n[t].estado),i[4]='<button type="button" value="Actualizar" title="Editar" class="btn btn-primary  btn-xs  btn-edit btn_datatable"><i class="glyphicon glyphicon-pencil" aria-hidden="true"><\/i><\/button>',objTablaPerfiles.dataTable().fnAddData(i,!1);tablaPerfiles.draw();$('[data-toggle="tooltip"]').tooltip();$('[data-toggle="tooltip"]').tooltip().off("focusin focusout");$("#infoTituloPerfiles").length||$("<span id='infoTituloPerfiles' class='dataTables_info' role='status' aria-live='polite'>LISTA DE PERFILES DE USUARIO&nbsp;&nbsp;&nbsp;<\/span>").prependTo("#tbl_perfiles_wrapper div.dt-buttons")}function iniciarDataTableReportes(){tablaReportes=objTablaReportes.DataTable({language:{url:"bower_components/datatables-buttons/json/spanish.json"},aaSorting:[[1,"asc"]],bDestroy:!0,bDeferRender:!0,paging:!1,scrollY:$(document).height()-613+"px",scrollCollapse:!0,bSort:!0,autoWidth:!0,responsive:!0,aoColumns:[{sWidth:"60px",sSortDataType:"dom-checkbox",sClass:"centerEnTabla"},{sWidth:"80px",sClass:"textoCentrado"},null,null,null,null,null,null]})}function agregarFilasDT_Reportes(n){var i,t;for(objTablaReportes.dataTable().fnClearTable(),i=[],t=0;t<n.length;t++)i.push(['<input type="checkbox" class="check" value='+n[t].cod_reporte+">",n[t].cod_reporte,n[t].sistema,n[t].nombre,n[t].cod_alterno,n[t].ubicacion,n[t].propietario,spanEstado(n[t].estado)]);objTablaReportes.dataTable().fnAddData(i,!1);tablaReportes.draw();iCheckAplicar("tbl_reportes_wrapper","iCheckReportes");$("#infoTituloReportes").length||$("<div id='infoTituloReportes' class='dataTables_info' role='status' aria-live='polite'>LISTA DE REPORTES<\/div>").appendTo("#tbl_reportes_wrapper .col-sm-6:first")}function iniciarDataTableUsuarios(){tablaUsuarios=objTablaUsuarios.DataTable({language:{url:"bower_components/datatables-buttons/json/spanish.json"},aaSorting:[[2,"asc"]],bDestroy:!0,bDeferRender:!0,paging:!1,scrollY:$(document).height()-613+"px",scrollCollapse:!0,bSort:!0,autoWidth:!0,responsive:!0,aoColumns:[{sWidth:"60px",sSortDataType:"dom-checkbox",sClass:"centerEnTabla"},{sWidth:"80px",sClass:"textoCentrado"},null,null,null,null,null,null]})}function agregarFilasDT_Usuarios(n){var t,i;for(objTablaUsuarios.dataTable().fnClearTable(),t=0;t<n.length;t++)i=[],i[0]='<input type="checkbox" class="check" value='+n[t].cod_usuario+">",i[1]=n[t].cod_usuario,i[2]=n[t].nombre,i[3]=n[t].sucursal.nombre,i[4]=n[t].departamento.nombre,i[5]=n[t].rol.nombre,i[6]=n[t].login,i[7]=spanEstado(n[t].i_estado),objTablaUsuarios.dataTable().fnAddData(i,!1);tablaUsuarios.draw();iCheckAplicar("tbl_usuarios_wrapper","iCheckUsuarios");$("#infoTituloUsuarios").length||$("<div id='infoTituloUsuarios' class='dataTables_info' role='status' aria-live='polite'>LISTA DE USUARIOS<\/div>").appendTo("#tbl_usuarios_wrapper .col-sm-6:first")}function iCheckAplicar(n,t){$("#"+n+" input").iCheck({checkboxClass:"icheckbox_futurico",radioClass:"iradio_futurico"});$("#"+t+"").on("ifChecked",function(){$("#"+n+" .check").iCheck("check");t==="iCheckReportes"?triggeredByChildReportes=!1:triggeredByChildUsuarios=!1});$("#"+t+"").on("ifUnchecked",function(){t==="iCheckReportes"?(triggeredByChildReportes||$("#"+n+" .check").iCheck("uncheck"),triggeredByChildReportes=!1):(triggeredByChildUsuarios||$("#"+n+" .check").iCheck("uncheck"),triggeredByChildUsuarios=!1)});$("#"+n+" .check").on("ifUnchecked",function(){t==="iCheckReportes"?(triggeredByChildReportes=!0,$("#"+t+"").iCheck("uncheck")):(triggeredByChildUsuarios=!0,$("#"+t+"").iCheck("uncheck"))});$("#"+n+" .check").on("ifChecked",function(){$("#"+n+" .check").filter(":checked").length===$("#"+n+" .check").length&&$("#"+t+"").iCheck("check")})}function spanEstado(n){return n==="Activo"?'<span class="label label-success" style="font-size:9px;">'+n+"<\/span>":n==="Inactivo"?'<span class="label label-danger"  style="font-size:9px;">'+n+"<\/span>":'<span class="label label-warning"  style="font-size:9px;">'+n+"<\/span>"}function llenarDataModal(){var n="Actualizar el Perfil ( "+$("#txtNombrePerfil").val()+" )",t="ID: "+$("#txtIDPerfil").val()+"     |     Nombre: "+$("#txtNombrePerfil").val()+"     |     Estado: "+$("#ddlEstado option:selected").text(),i=$("#txtDescripcionPerfil").val(),r=reportesSeleccionados(),u=usuariosSeleccionadosLogin();$("#ModalTitulo").text(n);$("#ModalTxtPerfilDetalle").val(t);$("#ModalTxtPerfilDescripcion").val(i);$("#ModalTxtPerfilReportes").val(r);$("#ModalTxtPerfilUsuarios").val(u)}function CrearPerfil(){var t,i=$("#txtNombrePerfil").val(),r=$("#txtDescripcionPerfil").val();t=$("#txtIDPerfil").val()===""?"P":$("#ddlEstado").val();var u=reportesSeleccionados(),f=usuariosSeleccionados(),n={};n.id="0";n.nombre=i;n.descripcion=r;n.estado=t;n.listaReportes=u;n.listaUsuarios=f;n.login=login;n.cod_usuario=cod_usuario;AjaxCrearPerfil(n)}function reportesSeleccionados(){return tablaReportes.$("input:checkbox:checked").map(function(){return $(this).val()}).toArray()}function usuariosSeleccionados(){return tablaUsuarios.$("input:checkbox:checked").map(function(){return $(this).val()}).toArray()}function usuariosSeleccionadosLogin(){return $(tablaUsuarios.$("input:checkbox:checked").map(function(){return $(this).closest("tr").find("td").eq(6).html()})).toArray().join(" - ")}function ActualizarPerfil(){var t=$("#txtIDPerfil").val(),i=$("#txtNombrePerfil").val(),r=$("#txtDescripcionPerfil").val(),u=$("#ddlEstado").val(),f=reportesSeleccionados(),e=usuariosSeleccionados(),n={};n.id=t;n.nombre=i;n.descripcion=r;n.estado=u;n.listaReportes=f;n.listaUsuarios=e;n.login=login;n.cod_usuario=cod_usuario;AjaxActualizarPerfil(n)}function CargarReportes(){var n={};n.codigoPerfil="0";n.listaReportes="";AjaxCargarReportes(n)}function CargarUsuarios(){AjaxCargarUsuarios()}function CargarReportesUsuariosPorPerfil(){var t=data[0],n={};n.codigoPerfil=t;AjaxCargarUsuariosPorPerfil(n);AjaxCargarReportesPorPerfil(n)}function MarcarReportesPerfil(n){var t,i=n;t=tablaReportes.$("input:checkbox.check").map(function(){if(jQuery.inArray($(this).val(),i)!==-1)return $(this).iCheck("check"),$(this).val()}).toArray()}function MarcarUsuariosPerfil(n){var t,i=n;t=tablaUsuarios.$("input:checkbox.check").map(function(){if(jQuery.inArray($(this).val(),i)!==-1)return $(this).iCheck("check"),$(this).val()}).toArray()}function llenarRegistroPerfiles(){var n=data[0],t=data[1],i=data[2],r=$.parseHTML(data[3])[0].innerHTML;$("#txtIDPerfil").val(n);$("#txtNombrePerfil").val(t).prop("disabled",!0);$("#txtDescripcionPerfil").val(i);$("#ddlEstado").val($("#ddlEstado option:contains('"+r+"')").val())}function limpiarRegistroPerfil(){var n;n=$("#Editar").length?"Activo":"Pendiente";$("#txtIDPerfil").val("");$("#txtNombrePerfil").val("");$("#txtDescripcionPerfil").val("");$("#ddlEstado").val($("#ddlEstado option:contains('"+n+"')").val());$("#FnAgregar").length?$("#txtNombrePerfil").prop("disabled",!1):$("#txtNombrePerfil").prop("disabled",!0);objTablaReportes.dataTable().fnFilter("");objTablaUsuarios.dataTable().fnFilter("");$(".check").iCheck("uncheck");objTablaReportes.dataTable().fnSort([1,"asc"]);objTablaUsuarios.dataTable().fnSort([1,"asc"])}function AjaxCargarPerfiles(){$.ajax({type:"POST",url:paginaUrl+"/CargarPerfiles",data:{},contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta=console.log(n.status+"\n"+n.responseText,"\n"+i);Alerta("mensajeAlerta",MensajeAlerta,"danger",6e3)},success:function(n){agregarFilasDT_Perfiles(n.d)}})}function AjaxCargarReportes(n){n=JSON.stringify(n);$.ajax({type:"POST",url:paginaUrl+"/CargarReportes",data:n,contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta=console.log(n.status+"\n"+n.responseText,"\n"+i);Alerta("mensajeAlerta",MensajeAlerta,"danger",6e3)},success:function(n){agregarFilasDT_Reportes(n.d)}})}function AjaxCargarReportesPorPerfil(n){n=JSON.stringify(n);$.ajax({type:"POST",url:paginaUrl+"/ReportesPorPerfil",data:n,contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta=console.log(n.status+"\n"+n.responseText,"\n"+i);Alerta("mensajeAlerta",MensajeAlerta,"danger",6e3)},success:function(n){MarcarReportesPerfil(n.d);objTablaReportes.dataTable().fnSort([0,"asc"])}})}function AjaxCargarUsuariosPorPerfil(n){n=JSON.stringify(n);$.ajax({type:"POST",url:paginaUrl+"/UsuariosPorPerfil",data:n,contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta=console.log(n.status+"\n"+n.responseText,"\n"+i);Alerta("mensajeAlerta",MensajeAlerta,"danger",6e3)},success:function(n){MarcarUsuariosPerfil(n.d);objTablaUsuarios.dataTable().fnSort([0,"asc"])}})}function AjaxCrearPerfil(n){n=JSON.stringify(n);$.ajax({type:"POST",url:paginaUrl+"/CrearPerfil",data:n,contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta=console.log(n.status+"\n"+n.responseText,"\n"+i);mensajeError(MensajeAlerta,paginaUrl);setTimeout(function(){window.location="./Login.aspx"},3e3)},success:function(n){n.d===!0&&(AjaxCargarPerfiles(),MensajeAlerta="El perfil se registró correctamente!",Alerta("mensajeAlerta",MensajeAlerta,"success",2e3),limpiarRegistroPerfil())}})}function AjaxActualizarPerfil(n){n=JSON.stringify(n);$.ajax({type:"POST",url:paginaUrl+"/ActualizarPerfil",data:n,contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta=console.log(n.status+"\n"+n.responseText,"\n"+i);mensajeError(MensajeAlerta,paginaUrl);setTimeout(function(){window.location="./Login.aspx"},3e3)},success:function(n){n.d&&(AjaxCargarPerfiles(),MensajeAlerta="El perfil se actualizó correctamente!",Alerta("mensajeAlerta",MensajeAlerta,"success",2e3),limpiarRegistroPerfil())}})}function AjaxCargarUsuarios(){$.ajax({type:"POST",url:paginaUrl+"/ListarUsuarios",data:{},contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta=console.log(n.status+"\n"+n.responseText,"\n"+i);Alerta("mensajeAlerta",MensajeAlerta,"danger",6e3)},success:function(n){agregarFilasDT_Usuarios(n.d)}})}var paginaUrl="Perfiles.aspx",tablaPerfiles,data,objTablaPerfiles=$("#tbl_perfiles"),tablaReportes,dataReportes,objTablaReportes=$("#tbl_reportes"),tablaUsuarios,dataUsuarios,objTablaUsuarios=$("#tbl_usuarios"),inicio,MensajeAlerta,tipoMsj,triggeredByChildReportes=!1,triggeredByChildUsuarios=!1,nombreReportePerfil="Lista de Perfiles - Report Manager";$(function(){$('[data-toggle="tooltip"]').tooltip();$('[data-toggle="tooltip"]').tooltip().off("focusin focusout")});$(document).ready(function(){iniciarDataTablePerfiles();iniciarDataTableUsuarios();iniciarDataTableReportes();CargarUsuarios();CargarReportes();AjaxCargarPerfiles()});$(function(){$.fn.dataTable.ext.order["dom-checkbox"]=function(n,t){return this.api().column(t,{order:"index"}).nodes().map(function(n){return $("input",n).prop("checked")?"0":"1"})};$('a[href="#tab_2_usuarios"], a[href="#tab_1_reportes"]').on("shown.bs.tab",function(){$($.fn.dataTable.tables(!0)).DataTable().columns.adjust()});$("#btn_Perfiles_Editar").on("click",function(){ActualizarPerfil()});$("#btn_Perfiles_Agregar").on("click",function(){var n=$("#txtNombrePerfil").val(),t,i,r;n!==""?(t=0,i=tablaPerfiles.rows().column(1).data().toArray(),r=$("#txtIDPerfil").val(),r!==""?(llenarDataModal(),$("#modal_actualizar").modal("show")):$("#FnAgregar").length?(t=jQuery.inArray(n,i),t===-1?CrearPerfil():tablaPerfiles.data().any()&&Alerta("mensajeAlerta","El Perfil ( "+n+" ) ya Existe!","danger",2e3)):Alerta("mensajeAlerta","No tiene permiso para Agregar perfiles!","danger",2e3)):$("#txtNombrePerfil").focus()});$("#btnCancelar").on("click",function(){limpiarRegistroPerfil()});$(document).on("click",".btn-edit:not(.disabled)",function(){limpiarRegistroPerfil();var n=$(this).parent().parent()[0];data=objTablaPerfiles.fnGetData(n);llenarRegistroPerfiles();CargarReportesUsuariosPorPerfil()});$(document).keypress(function(n){var f=n.which,t,i,r,u;f===13&&(t=$("#txtNombrePerfil").val(),t!==""?(i=0,r=tablaPerfiles.rows().column(1).data().toArray(),u=$("#txtIDPerfil").val(),u!==""?(llenarDataModal(),$("#modal_actualizar").modal("show")):(i=jQuery.inArray(t,r),i===-1?CrearPerfil():tablaPerfiles.data().any()&&Alerta("mensajeAlerta","El Perfil ( "+t+" ) ya Existe!","danger",2e3))):$("#txtNombrePerfil").focus())})});