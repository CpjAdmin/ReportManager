function validaControl(n){return validacion=!1,n==="E"&&$("#FnEditar").length&&(validacion=!0),validacion}function vistaPreviaImagen(n){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(n){$("#imagenUsuario").css("visibility","visible");$("#imagenUsuario").attr("src",n.target.result)};t.readAsDataURL(n.files[0])}}function iniciarDataTable(){tabla=objTabla.DataTable({pageLength:500,lengthMenu:[[500,1e3,2e3,-1],["500 Registros","1000 Registros","2000 Registros","Todos"]],dom:"Bfrtip",buttons:[{extend:"pageLength"},{extend:"csvHtml5",text:"CSV",exportOptions:{columns:[0,1,2,3,4,5,6]},title:function(){return nombreReporte}},{extend:"excelHtml5",text:"EXCEL",exportOptions:{columns:[0,1,2,3,4,5,6]},title:function(){return nombreReporte},sheetName:"Usuarios"}],language:{url:"bower_components/datatables-buttons/json/spanish.json",buttons:{pageLength:{_:"MOSTRAR %d REGISTROS","-1":"TODOS"}}},fnDrawCallback:function(){var n=objTabla.DataTable();n.data().length===0?n.buttons(".dt-button").disable():n.buttons(".dt-button").enable()},aaSorting:[[0,"desc"]],bDestroy:!0,bDeferRender:!0,paging:!1,scrollY:$(document).height()-440+"px",scrollCollapse:!0,scroller:!0,bSort:!0,autoWidth:!1,responsive:!0,aoColumns:[{sWidth:"100px",sClass:"textoCentrado"},null,null,null,null,null,null,{bSortable:!1,visible:validaControl("E")}]})}function agregarFilasDT(n){function r(n){return n==="Activo"?'<span class="label label-success" style="font-size:9px;">'+n+"<\/span>":'<span class="label label-danger"  style="font-size:9px;">'+n+"<\/span>"}var i,t;for(objTabla.dataTable().fnClearTable(),i=[],t=0;t<n.length;t++)i.push([n[t].cod_usuario,n[t].nombre,n[t].sucursal.nombre,n[t].departamento.nombre,n[t].rol.nombre,n[t].login,r(n[t].i_estado),'<button type="button" value="Actualizar" title="Actualizar" class="btn btn-xs btn-primary btn-edit btn_datatable" data-target="#modal_actualizar" data-toggle="modal"><i class="glyphicon glyphicon-pencil" aria-hidden="true"><\/i><\/button>&nbsp;<button type="button" value="Eliminar" title="Eliminar" class="btn btn-xs btn-danger btn-delete btn_datatable"><i class="fa fa-minus-square-o" aria-hidden="true"><\/i><\/button>']);objTabla.dataTable().fnAddData(i,!1);tabla.draw()}function enviarDatosAjax(){$.ajax({type:"POST",url:paginaUrl+"/ListarUsuarios",data:{},contentType:"application/json; charset=utf-8",error:function(n,t,i){console.log(n.status+"\n"+n.responseText,"\n"+i)},success:function(n){agregarFilasDT(n.d)}})}function llenarDataModal(){$("#ModalTxtNombre").val(data[1]);$("#ModalDdlSucursal").val($("#ModalDdlSucursal option:contains('"+data[2]+"')").val());$("#ModalDdlDepartamento").val($("#ModalDdlDepartamento option:contains('"+data[3]+"')").val());$("#ModalDdlRol").val($("#ModalDdlRol option:contains('"+data[4]+"')").val());$("#ModalTxtClave").val("        ");$("#ModalDdlEstado").val($("#ModalDdlEstado option:contains('"+$.parseHTML(data[6])[0].innerHTML+"')").val())}function cerrarModalActualizar(){$("#modal_actualizar").modal("hide")}function actualizarDataAjax(){var n=JSON.stringify({id:cod_usuario,cod_usuario_actualzar:data[0],login_actualizar:data[5],nombre:$("#ModalTxtNombre").val(),cod_sucursal:$("#ModalDdlSucursal").val(),cod_departamento:$("#ModalDdlDepartamento").val(),cod_rol:$("#ModalDdlRol").val(),clave:$("#ModalTxtClave").val(),i_estado:$("#ModalDdlEstado").val()});$.ajax({type:"POST",url:"Registro_Usuarios.aspx/ActualizarUsuario",data:n,dataType:"json",contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta=n.status+"\n"+n.responseText;"\n"+i;mensajeError(MensajeAlerta,paginaUrl)},success:function(n){n.d?(MensajeAlerta="Registro actualizado correctamente.",Alerta("mensajesAlerta",MensajeAlerta,"success",2e3)):(MensajeAlerta="No se pudo actualizar el Registro.",Alerta("mensajesAlerta",MensajeAlerta,"danger",2e3))}})}function deleteDataAjax(n){var t=JSON.stringify(n);$.ajax({type:"POST",url:"Registro_Usuarios.aspx/EliminarUsuario",data:t,dataType:"json",contentType:"application/json; charset=utf-8",error:function(n,t,i){MensajeAlerta=n.status+"\n"+n.responseText;"\n"+i;mensajeError(MensajeAlerta,paginaUrl)},success:function(n){n.d?(MensajeAlerta="Usuario inactivado correctamente!",Alerta("mensajesAlerta",MensajeAlerta,"danger",2e3)):(MensajeAlerta="No fue posible inactivar el registro!",Alerta("mensajesAlerta",MensajeAlerta,"danger",2e3))}})}var tabla,data,objTabla=$("#tbl_usuarios"),paginaUrl="Registro_Usuarios.aspx",nombreReporte="Lista de Usuarios Report Manager";$(function(){iniciarDataTable();enviarDatosAjax()});$(document).on("click",".btn-edit",function(n){n.preventDefault();var t=$(this).parent().parent()[0];data=objTabla.fnGetData(t);llenarDataModal()});$("#btn_Usuarios_Editar").click(function(n){n.preventDefault();actualizarDataAjax();enviarDatosAjax();cerrarModalActualizar()});$("#btnModalCancelar").click(function(n){n.preventDefault();cerrarModalActualizar()});$(document).on("click",".btn-delete",function(n){var i,r,t;n.preventDefault();i=$(this).closest("tr");r=i.find("td:eq(6)").text();r!=="Inactivo"?(t={},t.id=cod_usuario,t.cod_usuario=i.find("td:eq(0)").text(),t.login=i.find("td:eq(1)").text(),deleteDataAjax(t),enviarDatosAjax()):(MensajeAlerta="El usuario ya est√° inactivo!",Alerta("mensajesAlerta",MensajeAlerta,"warning",2e3))});